<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥§ç‰¹æ›¼å…¨èƒ½æŒ‘æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: Arial, "PMingLiU", "æ–°ç´°æ˜é«”", "Microsoft JhengHei", sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 2rem;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            width: 95vw;
            max-width: 850px;
            max-height: 95vh;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            border: 6px solid #ef4444;
            overflow-y: auto;
        }

        /* iPad Mini æ©«å¼å„ªåŒ– */
        @media (orientation: landscape) and (max-height: 700px) {
            .game-container-layout { display: flex; flex-direction: row; align-items: center; gap: 20px; }
            .side-info { width: 150px; flex-shrink: 0; }
            .main-game-area { flex: 1; }
            #question-area { font-size: 2.25rem !important; }
        }

        .ultraman-avatar {
            width: 80px; height: 80px;
            margin: -50px auto 10px;
            background: #fff;
            border-radius: 50%;
            border: 5px solid #ef4444;
            display: flex; align-items: center; justify-content: center;
            font-size: 40px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .number-btn, .letter-btn {
            background: #f3f4f6; border: 2px solid #e5e7eb; touch-action: manipulation;
        }
        .number-btn:active, .letter-btn:active { background: #d1d5db; transform: scale(0.95); }

        .star-particle { position: absolute; pointer-events: none; animation: fly 1s ease-out forwards; }
        @keyframes fly { 0% { transform: translate(0,0) scale(1); opacity: 1; } 100% { transform: translate(var(--dx), var(--dy)) scale(0); opacity: 0; } }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body>

<div class="game-card" id="game-container">
    <div class="ultraman-avatar" id="avatar">ğŸ¦¸</div>
    
    <!-- ä¸»é¸å–® -->
    <div id="category-screen" class="w-full">
        <h1 class="text-3xl font-bold text-red-600 mb-2">å¥§ç‰¹æ›¼å…¨èƒ½æŒ‘æˆ°</h1>
        <p class="text-blue-600 mb-6 font-bold">ç­”å° 20 é¡Œç²å¾—çç›ƒ ğŸ†</p>
        <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
            <button onclick="showSubMenu('math')" class="bg-blue-600 text-white text-xl py-5 rounded-2xl shadow-lg font-bold">æ•¸å­¸æŒ‘æˆ° â•</button>
            <button onclick="showSubMenu('english')" class="bg-purple-600 text-white text-xl py-5 rounded-2xl shadow-lg font-bold">è‹±æ–‡æŒ‘æˆ° ğŸ”¤</button>
        </div>
    </div>

    <!-- æ•¸å­¸å­é¸å–® -->
    <div id="math-menu" class="hidden w-full">
        <h2 class="text-2xl font-bold text-blue-700 mb-6">æ•¸å­¸ç·´ç¿’é …ç›®</h2>
        <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
            <button onclick="startGame('sequence')" class="bg-white border-2 border-blue-600 text-blue-600 text-lg py-4 rounded-xl font-bold">1-30 æ•¸åˆ— (3~6å€‹æ•¸)</button>
            <button onclick="startGame('arithmetic')" class="bg-white border-2 border-blue-600 text-blue-600 text-lg py-4 rounded-xl font-bold">1-10 åŠ æ¸›æ³•</button>
            <button onclick="location.reload()" class="mt-4 text-gray-500 underline">è¿”å›</button>
        </div>
    </div>

    <!-- è‹±æ–‡å­é¸å–® -->
    <div id="english-menu" class="hidden w-full">
        <h2 class="text-2xl font-bold text-purple-700 mb-6">è‹±æ–‡ç·´ç¿’é …ç›®</h2>
        <div class="grid grid-cols-1 gap-4 max-w-sm mx-auto">
            <button onclick="startGame('upper-to-lower')" class="bg-white border-2 border-purple-600 text-purple-600 text-lg py-4 rounded-xl font-bold">å¤§å¯«é¸å°å¯« (A â†’ a)</button>
            <button onclick="startGame('lower-to-upper')" class="bg-white border-2 border-purple-600 text-purple-600 text-lg py-4 rounded-xl font-bold">å°å¯«é¸å¤§å¯« (a â†’ A)</button>
            <button onclick="location.reload()" class="mt-4 text-gray-400 underline">è¿”å›</button>
        </div>
    </div>

    <!-- éŠæˆ²å€åŸŸ -->
    <div id="game-screen" class="hidden w-full">
        <div class="game-container-layout">
            <div class="side-info">
                <div class="flex justify-between items-center mb-4 landscape:block">
                    <div class="text-center font-bold text-gray-500 text-sm mb-1" id="q-progress">å·²ç­”å°: 0 / 20 é¡Œ</div>
                    <div id="score-display" class="bg-yellow-400 text-blue-900 px-4 py-1 rounded-full font-bold text-center">Score: 0</div>
                    <button onclick="location.reload()" class="mt-2 text-gray-400 font-bold text-xs">âŒ é€€å‡º</button>
                </div>
            </div>

            <div class="main-game-area">
                <div id="question-area" class="text-4xl md:text-5xl font-bold text-blue-900 mb-4 h-20 flex items-center justify-center tracking-widest overflow-hidden"></div>

                <div id="answer-box-container" class="flex justify-center items-center gap-2 mb-4">
                    <div id="std-input-wrap">
                        <input type="text" id="answer-input" readonly class="w-48 text-center text-4xl border-b-4 border-blue-500 bg-blue-50 text-red-600 font-bold rounded-t-lg" placeholder="?">
                    </div>
                </div>

                <div id="num-keyboard" class="grid grid-cols-5 gap-2 w-full max-w-sm mx-auto mb-4 hidden">
                    <script>
                        for(let i=1; i<=9; i++) document.write(`<button onclick="pressKey('${i}')" class="number-btn py-3 rounded-xl text-2xl font-bold">${i}</button>`);
                        document.write(`<button onclick="pressKey('0')" class="number-btn py-3 rounded-xl text-2xl font-bold">0</button>`);
                    </script>
                </div>

                <div id="letter-keyboard" class="hidden w-full max-w-md mx-auto mb-4">
                    <div class="grid grid-cols-7 gap-1" id="alphabet-btns"></div>
                </div>

                <div class="grid grid-cols-3 gap-2 w-full max-w-sm mx-auto">
                    <button onclick="clearInput()" class="bg-gray-400 text-white py-3 rounded-xl font-bold">æ¸…é™¤</button>
                    <button onclick="nextQuestion(true)" class="bg-yellow-500 text-white py-3 rounded-xl font-bold">è·³é</button>
                    <button onclick="checkAnswer()" class="bg-green-500 text-white py-3 rounded-xl font-bold shadow-md">ç¢ºå®š ğŸ’¥</button>
                </div>
                <div id="feedback" class="mt-4 h-6 font-bold text-lg"></div>
            </div>
        </div>
    </div>

    <!-- çµæœç•«é¢ -->
    <div id="result-screen" class="hidden w-full">
        <h2 class="text-3xl font-bold text-red-600 mb-4">æŒ‘æˆ°æˆåŠŸï¼</h2>
        <div class="text-6xl mb-4">ğŸ†âœ¨</div>
        <p class="text-2xl mb-2 font-bold text-blue-800">100 åˆ†é”æˆï¼</p>
        <p class="text-lg text-gray-600 mb-6">ä½ è´å¾—äº†å¥§ç‰¹æ›¼æ¦®è€€çç›ƒ</p>
        <button onclick="location.reload()" class="w-full max-w-xs mx-auto bg-blue-600 text-white py-4 rounded-xl text-xl font-bold">å†ç©ä¸€æ¬¡</button>
    </div>
</div>

<script>
    let mode = '';
    let target = '';
    let inputArr = [];
    let score = 0;
    const targetScore = 100;
    const pointsPerQuestion = 5;

    const alphabet = "abcdefghijklmnopqrstuvwxyz".split('');
    let usedLetters = [];

    function showSubMenu(cat) {
        document.getElementById('category-screen').classList.add('hidden');
        document.getElementById(cat + '-menu').classList.remove('hidden');
    }

    function updateLetterKeyboard(isUpper) {
        const container = document.getElementById('alphabet-btns');
        container.innerHTML = '';
        alphabet.forEach(l => {
            const displayChar = isUpper ? l.toUpperCase() : l.toLowerCase();
            const btn = document.createElement('button');
            btn.className = 'letter-btn py-2 rounded-lg text-lg font-bold';
            btn.innerText = displayChar;
            btn.onclick = () => pressKey(displayChar);
            container.appendChild(btn);
        });
    }

    function startGame(m) {
        mode = m;
        score = 0;
        usedLetters = [];
        document.getElementById('math-menu').classList.add('hidden');
        document.getElementById('english-menu').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        
        const isEnglish = (m === 'upper-to-lower' || m === 'lower-to-upper');
        document.getElementById('num-keyboard').classList.toggle('hidden', isEnglish);
        document.getElementById('letter-keyboard').classList.toggle('hidden', !isEnglish);

        if (isEnglish) updateLetterKeyboard(m === 'lower-to-upper');
        
        nextQuestion();
    }

    function nextQuestion(isSkip = false) {
        if (score >= targetScore) {
            endGame();
            return;
        }

        document.getElementById('q-progress').innerText = `å·²ç­”å°: ${score/5} / 20 é¡Œ`;
        inputArr = [];
        updateUI();
        document.getElementById('feedback').innerText = '';
        document.getElementById('avatar').innerText = "ğŸ¤”";

        const qText = document.getElementById('question-area');

        if(mode === 'sequence') {
            const len = Math.floor(Math.random() * 4) + 3; 
            const start = Math.floor(Math.random() * (30 - len)) + 1;
            const seq = Array.from({length: len}, (_, i) => start + i);
            const gapIdx = Math.floor(Math.random() * len);
            target = seq[gapIdx].toString();
            qText.innerText = seq.map((n, i) => i === gapIdx ? "__" : n).join(", ");
            qText.style.fontSize = len > 5 ? "1.5rem" : "2.25rem";
        } 
        else if(mode === 'arithmetic') {
            let a = Math.floor(Math.random()*5)+5, b = Math.floor(Math.random()*5)+1;
            if(Math.random() > 0.5) { target = (a+b).toString(); qText.innerText = `${a} + ${b} = ?`; }
            else { target = (a-b).toString(); qText.innerText = `${a} - ${b} = ?`; }
            qText.style.fontSize = "3rem";
        }
        else if(mode === 'upper-to-lower' || mode === 'lower-to-upper') {
            if (usedLetters.length >= 26) usedLetters = [];
            let available = alphabet.filter(l => !usedLetters.includes(l));
            let char = available[Math.floor(Math.random() * available.length)];
            usedLetters.push(char);

            if (mode === 'upper-to-lower') {
                target = char.toLowerCase();
                qText.innerHTML = `<span class="text-7xl text-purple-700">${char.toUpperCase()}</span> <span class="text-xl ml-4">é¸å°å¯«</span>`;
            } else {
                target = char.toUpperCase();
                qText.innerHTML = `<span class="text-7xl text-purple-700">${char.toLowerCase()}</span> <span class="text-xl ml-4">é¸å¤§å¯«</span>`;
            }
        }
    }

    function pressKey(k) {
        if(inputArr.length < 5) {
            inputArr.push(k);
            updateUI();
        }
    }

    function clearInput() { inputArr = []; updateUI(); }

    function updateUI() {
        document.getElementById('answer-input').value = inputArr.join('');
    }

    function checkAnswer() {
        if(inputArr.length === 0) return;
        let userAns = inputArr.join('');
        
        if(userAns === target) {
            score += pointsPerQuestion;
            document.getElementById('score-display').innerText = `Score: ${score}`;
            document.getElementById('avatar').innerText = "ğŸ¤©";
            document.getElementById('feedback').innerText = "æ­£ç¢ºï¼å¾—åˆ† +5 ğŸ’¥";
            document.getElementById('feedback').className = "mt-4 h-6 font-bold text-lg text-green-600";
            createStars();
            
            if (score >= targetScore) {
                setTimeout(endGame, 1000);
            } else {
                setTimeout(() => nextQuestion(), 1200);
            }
        } else {
            document.getElementById('avatar').innerText = "ğŸ˜µ";
            document.getElementById('feedback').innerText = "ä¸å°å–”ï¼Œå†è©¦è©¦çœ‹ï¼";
            document.getElementById('feedback').className = "mt-4 h-6 font-bold text-lg text-red-500";
            document.getElementById('game-container').classList.add('shake');
            setTimeout(() => document.getElementById('game-container').classList.remove('shake'), 500);
            clearInput();
        }
    }

    function createStars() {
        for (let i = 0; i < 15; i++) {
            const star = document.createElement('div');
            star.innerText = "â­";
            star.className = "star-particle";
            star.style.setProperty('--dx', (Math.random()-0.5)*400+'px');
            star.style.setProperty('--dy', (Math.random()-0.5)*400+'px');
            star.style.left = "50%"; star.style.top = "50%";
            document.getElementById('game-container').appendChild(star);
            setTimeout(() => star.remove(), 1000);
        }
    }

    function endGame() {
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('result-screen').classList.remove('hidden');
        document.getElementById('avatar').innerText = "ğŸ‘‘";
    }
</script>

</body>
</html>
